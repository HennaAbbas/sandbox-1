# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

parameters:
  xcode_version:
    type: string
    default: 14.1.0
  
jobs:
  build:
    macos:
      xcode: <<pipeline.parameters.xcode_version>>
    resource_class: macos.m1.medium.gen1
    parallelism: 10
    
    steps:
      - run: xcodebuild -version
      - run: brew --version
      - run:
          command: |
            while true; do
              sleep5
              sudo powermetrics --samplers gpu_power -i500 -n1 --show-usage-summary
            done
  background: true
      - run:
          command: |
            export SIMULATOR_UDID=$(xcrun simctl create testsim "iPhone 11" "iOS15.5")
            xcrun simctl boot $SIMULATOR_UDID
            xcrun simctl bootstatus $SIMULATOR_UDID
      
      
workflows:
  say-hello-workflow:
    jobs:
      - build
